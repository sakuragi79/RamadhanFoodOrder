<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadan Food Order Confirmation</title>
    <style>
        /* Basic Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }

        h1 {
            text-align: center;
            font-size: 24px;
        }

        .pack {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .menu-group {
            margin-bottom: 15px;
        }

        .menu-group-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .menu-item {
            margin-bottom: 5px;
        }

        #order-summary {
            display: none;
            margin-top: 20px;
        }

        #qr-code-image {
            max-width: 150px;
            max-height: 150px;
            margin-top: 10px;
        }

        #payment-slip-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #payment-section {
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #45a049;
        }

        .reminder {
            color: #d9534f; /* Red color for emphasis */
            font-weight: bold;
            margin-top: 10px;
        }

        .early-bird {
            color: #4CAF50; /* Green color for emphasis */
            font-weight: bold;
            margin-top: 10px;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            h1 {
                font-size: 20px;
            }

            .pack {
                padding: 8px;
            }

            button {
                width: 100%;
                padding: 12px;
            }
        }
    </style>
    <script>
        // Define Ramadan start and end dates for 2025
        const ramadanStartDate = new Date('2025-03-01');
        const ramadanEndDate = new Date('2025-03-30');

        // Function to check if the selected date is within Ramadan
        function isRamadan(date) {
            return date >= ramadanStartDate && date <= ramadanEndDate;
        }

        // Function to get the day name from a date
        function getDayName(date) {
            const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            return days[date.getDay()];
        }

        // Function to generate Ramadan days with CE dates
        function generateRamadanDays() {
            const ramadanDays = [];
            const currentDate = new Date(ramadanStartDate);

            for (let day = 1; day <= 30; day++) {
                const ceDate = currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                ramadanDays.push({ day, ceDate });
                currentDate.setDate(currentDate.getDate() + 1);
            }

            return ramadanDays;
        }

        // Function to update the selected date and display CE date
        function updateSelectedDate() {
            const ramadanDaySelect = document.getElementById('ramadan-day');
            const ceDateDisplay = document.getElementById('ce-date');
            const dayNameDisplay = document.getElementById('day-name');
            const selectedDay = ramadanDaySelect.value;

            if (selectedDay) {
                const ramadanDays = generateRamadanDays();
                const selectedDate = ramadanDays[selectedDay - 1];
                ceDateDisplay.textContent = `CE Date: ${selectedDate.ceDate}`;

                // Get the day name
                const date = new Date(ramadanStartDate);
                date.setDate(ramadanStartDate.getDate() + (selectedDay - 1));
                const dayName = getDayName(date);
                dayNameDisplay.textContent = `Day: ${dayName}`;
            } else {
                ceDateDisplay.textContent = 'CE Date: ';
                dayNameDisplay.textContent = 'Day: ';
            }
        }

        // Function to calculate the total price
        function calculateTotal() {
            let total = 0;

            // Calculate RPS (Ramadan Pack Specific)
            const rpsSelected = document.querySelector('input[name="rps"]:checked');
            if (rpsSelected) {
                total += 6.50;
            }

            // Calculate RP2C (Ramadan Pack 2 Compartment)
            const rp2cSelected = document.querySelector('input[name="rp2c"]:checked');
            if (rp2cSelected) {
                total += 5.00;
            }

            // Calculate RPR (Ramadan Pack Roti)
            const rprSelected = document.querySelector('input[name="rpr"]:checked');
            if (rprSelected) {
                total += 5.00;
            }

            // Calculate RPNPB (Ramadan Pack Nasi Putih Berlauk)
            const rpnpbSelected = document.querySelector('input[name="rpnpb"]:checked');
            if (rpnpbSelected) {
                total += 10.00;
            }

            // Calculate combo add-ons
            const comboAddon = document.querySelector('input[name="combo"]:checked');
            if (comboAddon) {
                total += 3.00;
            }

            return total;
        }

        // Function to proceed to the order summary
        function proceedToSummary() {
            const ramadanDaySelect = document.getElementById('ramadan-day');
            const selectedDay = ramadanDaySelect.value;

            if (!selectedDay) {
                alert('Please select a day of Ramadan.');
                return;
            }

            // Check if the selected day is Monday, Tuesday, or Wednesday
            const date = new Date(ramadanStartDate);
            date.setDate(ramadanStartDate.getDate() + (selectedDay - 1));
            const dayName = getDayName(date);

            if (!['Monday', 'Tuesday', 'Wednesday'].includes(dayName)) {
                alert('Orders are only processed on Monday, Tuesday, and Wednesday. Please select a valid day.');
                return;
            }

            // 1. Calculate and display order summary
            const summaryList = document.getElementById('summary-list');
            summaryList.innerHTML = ''; // Clear previous summary

            // Add selected items to summary
            const selectedItems = document.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked');
            selectedItems.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.labels[0].textContent; // Get label text
                summaryList.appendChild(li);
            });

            const total = calculateTotal();
            document.getElementById('summary-total').textContent = `Total: RM ${total.toFixed(2)}`;

            // 2. Hide the initial order form
            document.getElementById('order-form').style.display = 'none';

            // 3. Show the summary section
            document.getElementById('order-summary').style.display = 'block';
        }

        // Function to handle payment slip upload using Imgur API
        async function uploadPaymentSlip(file) {
            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        Authorization: 'Client-ID 6d93506cc27e293', // Updated Imgur Client ID
                    },
                    body: formData,
                });

                const data = await response.json();
                console.log('Imgur API Response:', data); // Log the API response for debugging

                if (data.success) {
                    // Ensure the link is a direct image link
                    const directImageLink = data.data.link.replace(/^http:\/\//i, 'https://');
                    return directImageLink; // Return the direct image URL
                } else {
                    throw new Error(data.data.error || 'Failed to upload image');
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                alert(`Failed to upload payment slip: ${error.message}`);
                return null;
            }
        }

        // Function to handle payment slip submission
        async function submitPaymentSlip() {
            const fileInput = document.getElementById('payment-slip');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please upload a payment slip.');
                return;
            }

            const imageUrl = await uploadPaymentSlip(file);
            if (imageUrl) {
                alert(`Payment slip uploaded successfully! URL: ${imageUrl}`);
                // Show the WhatsApp button and reminder
                document.getElementById('whatsapp-button').style.display = 'block';
                document.getElementById('reminder').style.display = 'block';
                // Store the image URL for WhatsApp
                document.getElementById('whatsapp-button').setAttribute('data-image-url', imageUrl);
            }
        }

        // Function to send order to WhatsApp and reset page
        function sendOrderToWhatsApp() {
            // Get sender details
            const senderName = document.getElementById('name').value;
            const senderPhone = document.getElementById('tel').value;
            const senderAddress = document.getElementById('address').value;

            // Get order details
            const orderSummary = document.getElementById('summary-list').innerText;
            const total = document.getElementById('summary-total').innerText;
            const imageUrl = document.getElementById('whatsapp-button').getAttribute('data-image-url');

            // Seller's WhatsApp number
            const sellerWhatsAppNumber = '60189800195';

            // Format the WhatsApp message
            let message = `*Order Details:*\n\n` +
                          `*Sender Information:*\n` +
                          `Name: ${senderName}\n` +
                          `Phone: ${senderPhone}\n` +
                          `Address: ${senderAddress}\n\n` +
                          `*Order Summary:*\n${orderSummary}\n${total}\n\n` +
                          `*Payment Slip:* ${imageUrl}\n\n`;

            const encodedMessage = encodeURIComponent(message);

            // Create the WhatsApp URL with the seller's number
            const whatsappUrl = `https://wa.me/${sellerWhatsAppNumber}?text=${encodedMessage}`;

            // Open WhatsApp in a new tab
            window.open(whatsappUrl, '_blank');

            // Reset the page to initial state
            document.getElementById('order-summary').style.display = 'none';
            document.getElementById('order-form').style.display = 'block';
            document.getElementById('whatsapp-button').style.display = 'none';
            document.getElementById('reminder').style.display = 'none';
            document.getElementById('payment-slip-preview').style.display = 'none';
            document.getElementById('payment-slip-preview').src = '#';
            
            // Reset the form
            document.getElementById('order-form').reset();
            document.getElementById('ce-date').textContent = 'CE Date: ';
            document.getElementById('day-name').textContent = 'Day: ';
        }

        // Event listener for DOMContentLoaded
        window.addEventListener('DOMContentLoaded', (event) => {
            // Add event listeners for total calculation
            const inputs = document.querySelectorAll('input[type="radio"], input[type="checkbox"]');
            inputs.forEach(input => {
                input.addEventListener('change', calculateTotal);
            });

            // Add event listener for payment slip upload
            document.getElementById('payment-slip').addEventListener('change', (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    document.getElementById('payment-slip-preview').src = e.target.result;
                    document.getElementById('payment-slip-preview').style.display = 'block';
                };

                reader.readAsDataURL(file);
            });

            // Add event listener for Ramadan day selection
            document.getElementById('ramadan-day').addEventListener('change', updateSelectedDate);

            // Populate Ramadan days dropdown
            const ramadanDaySelect = document.getElementById('ramadan-day');
            const ramadanDays = generateRamadanDays();
            ramadanDays.forEach((day, index) => {
                const option = document.createElement('option');
                option.value = day.day;
                option.textContent = `Day ${day.day} (${day.ceDate})`;
                ramadanDaySelect.appendChild(option);
            });
        });
    </script>
</head>

<body>

    <h1>Ramadan Food Order Confirmation</h1>
    <p class="early-bird">Early Bird Offer: The first 50 orders will receive a gift!</p>

    <!-- Order Form -->
    <form id="order-form">
        <label for="ramadan-day">Select Ramadan Day:</label>
        <select id="ramadan-day" name="ramadan-day" required>
            <option value="">Select a day</option>
        </select>
        <p id="ce-date">CE Date: </p>
        <p id="day-name">Day: </p>

        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>

        <label for="tel">Phone Number:</label>
        <input type="tel" id="tel" name="tel" required>

        <label for="address">Address:</label>
        <textarea id="address" name="address" rows="4" required></textarea>

        <!-- Ramadan Pack Options -->
        <div class="pack">
            <div class="pack-title">Ramadan Pack Specific (RPS) - RM 6.50</div>
            <div class="menu-group">
                <div class="menu-group-title">Main Dish</div>
                <div class="menu-item">
                    <label><input type="radio" name="rps" value="nasilemak"> Nasi Lemak Pandan Ayam</label>
                </div>
                <div class="menu-item">
                    <label><input type="radio" name="rps" value="nasikakvogue"> Nasi Kak Vogue</label>
                </div>
                <div class="menu-item">
                    <label><input type="radio" name="rps" value="lontong"> Lontong</label>
                </div>
                <div class="menu-item">
                    <label><input type="radio" name="rps" value="bubur"> Bubur Nasi Berlauk</label>
                </div>
            </div>
        </div>

        <div class="pack">
            <div class="pack-title">Ramadan Pack 2 Compartment (RP2C) - RM 5</div>
            <div class="menu-group">
                <div class="menu-group-title">Main Dish</div>
                <div class="menu-item">
                    <label><input type="radio" name="rp2c" value="nasigoreng"> Nasi Goreng</label>
                </div>
            </div>
            <div class="menu-group">
                <div class="menu-group-title">Kuih</div>
                <div class="menu-item">
                    <label><input type="checkbox" name="rp2c[]" value="karipap"> Kuih Karipap</label>
                </div>
                <div class="menu-item">
                    <label><input type="checkbox" name="rp2c[]" value="paugoreng"> Kuih Pau Goreng Inti Kacang Merah</label>
                </div>
                <div class="menu-item">
                    <label><input type="checkbox" name="rp2c[]" value="apamkampung"> Kuih Apam Kampung</label>
                </div>
                <div class="menu-item">
                    <label><input type="checkbox" name="rp2c[]" value="lapisnyonya"> Kuih Lapis Nyonya</label>
                </div>
            </div>
        </div>

        <div class="pack">
            <div class="pack-title">Ramadan Pack Roti (RPR) - RM 5</div>
            <div class="menu-group">
                <div class="menu-group-title">Main Dish</div>
                <div class="menu-item">
                    <label><input type="radio" name="rpr" value="rotiburger"> Roti Burger Korean Garlic Cheese</label>
                </div>
                <div class="menu-item">
                    <label><input type="radio" name="rpr" value="rotibeef"> Roti Beef/Ayam Ramly Huzza</label>
                </div>
                <div class="menu-item">
                    <label><input type="radio" name="rpr" value="rotibenjo"> Roti Benjo Huzza</label>
                </div>
            </div>
        </div>

        <div class="pack">
            <div class="pack-title">Ramadan Pack Nasi Putih Berlauk (RPNPB) - RM 10</div>
            <div class="menu-group">
                <div class="menu-group-title">Main Dish</div>
                <div class="menu-item">
                    <label><input type="radio" name="rpnpb" value="ayamgoreng"> Ayam Goreng Berlado</label>
                </div>
                <div class="menu-item">
                    <label><input type="radio" name="rpnpb" value="ayamlemak"> Masak Lemak Cili Api Ayam</label>
                </div>
                <div class="menu-item">
                    <label><input type="radio" name="rpnpb" value="ikankari"> Ikan Masak Kari Asam Pedas</label>
                </div>
            </div>
        </div>

        <div class="pack">
            <div class="pack-title">Ramadan Pack Combo - Add RM 3</div>
            <div class="menu-group">
                <div class="menu-item">
                    <label><input type="checkbox" name="combo" value="tehais"> Teh Ais Kaw</label>
                </div>
                <div class="menu-item">
                    <label><input type="checkbox" name="combo" value="fruitcuts"> Fruit Cuts</label>
                </div>
            </div>
        </div>

        <button type="button" onclick="proceedToSummary()">Proceed</button>
    </form>

    <!-- Order Summary -->
    <div id="order-summary">
        <h2>Order Summary</h2>
        <ul id="summary-list"></ul>
        <p id="summary-total"></p>
        <img id="qr-code-image" src="https://i.imgur.com/6S0vvWu.jpeg" alt="QR Code">
        <p>Scan the QR code to make payment.</p>

        <div id="payment-section">
            <label for="payment-slip">Upload Payment Slip:</label>
            <input type="file" id="payment-slip" name="payment-slip" accept="image/*" required>
            <img id="payment-slip-preview" src="#" alt="Payment Slip Preview">
            <button type="button" onclick="submitPaymentSlip()">Submit Payment Slip</button>
            <button id="whatsapp-button" type="button" onclick="sendOrderToWhatsApp()" style="display: none;">Send Order to WhatsApp</button>
            <p id="reminder" class="reminder" style="display: none;">Don't forget to click "Send Order to WhatsApp" to confirm your order!</p>
        </div>
    </div>

</body>

</html>