<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadan Food Order Confirmation</title>
    <style>
        /* Your existing CSS styles */
    </style>
    <script>
        // Define Ramadan start and end dates for 2025
        const ramadanStartDate = new Date('2025-03-01');
        const ramadanEndDate = new Date('2025-03-30');

        // Function to check if the selected date is within Ramadan
        function isRamadan(date) {
            return date >= ramadanStartDate && date <= ramadanEndDate;
        }

        // Function to get the day name from a date
        function getDayName(date) {
            const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            return days[date.getDay()];
        }

        // Function to generate Ramadan days with CE dates
        function generateRamadanDays() {
            const ramadanDays = [];
            const currentDate = new Date(ramadanStartDate);

            for (let day = 1; day <= 30; day++) {
                const ceDate = currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                ramadanDays.push({ day, ceDate });
                currentDate.setDate(currentDate.getDate() + 1);
            }

            return ramadanDays;
        }

        // Function to update the selected date and display CE date
        function updateSelectedDate() {
            const ramadanDaySelect = document.getElementById('ramadan-day');
            const ceDateDisplay = document.getElementById('ce-date');
            const dayNameDisplay = document.getElementById('day-name');
            const selectedDay = ramadanDaySelect.value;

            if (selectedDay) {
                const ramadanDays = generateRamadanDays();
                const selectedDate = ramadanDays[selectedDay - 1];
                ceDateDisplay.textContent = `CE Date: ${selectedDate.ceDate}`;

                // Get the day name
                const date = new Date(ramadanStartDate);
                date.setDate(ramadanStartDate.getDate() + (selectedDay - 1));
                const dayName = getDayName(date);
                dayNameDisplay.textContent = `Day: ${dayName}`;
            } else {
                ceDateDisplay.textContent = 'CE Date: ';
                dayNameDisplay.textContent = 'Day: ';
            }
        }

        // Function to calculate the total price
        function calculateTotal() {
            let total = 0;

            // Calculate RPS (Ramadan Pack Specific)
            const rpsSelected = document.querySelector('input[name="rps"]:checked');
            if (rpsSelected) {
                total += 6.50;
            }

            // Calculate RP2C (Ramadan Pack 2 Compartment)
            const rp2cSelected = document.querySelector('input[name="rp2c"]:checked');
            if (rp2cSelected) {
                total += 5.00;
            }

            // Calculate RPR (Ramadan Pack Roti)
            const rprSelected = document.querySelector('input[name="rpr"]:checked');
            if (rprSelected) {
                total += 5.00;
            }

            // Calculate RPNPB (Ramadan Pack Nasi Putih Berlauk)
            const rpnpbSelected = document.querySelector('input[name="rpnpb"]:checked');
            if (rpnpbSelected) {
                total += 10.00;
            }

            // Calculate combo add-ons
            const comboAddon = document.querySelector('input[name="combo"]:checked');
            if (comboAddon) {
                total += 3.00;
            }

            return total;
        }

        // Function to proceed to the order summary
        function proceedToSummary() {
            const ramadanDaySelect = document.getElementById('ramadan-day');
            const selectedDay = ramadanDaySelect.value;

            if (!selectedDay) {
                alert('Please select a day of Ramadan.');
                return;
            }

            // Check if the selected day is Monday, Tuesday, or Wednesday
            const date = new Date(ramadanStartDate);
            date.setDate(ramadanStartDate.getDate() + (selectedDay - 1));
            const dayName = getDayName(date);

            if (!['Monday', 'Tuesday', 'Wednesday'].includes(dayName)) {
                alert('Orders are only processed on Monday, Tuesday, and Wednesday. Please select a valid day.');
                return;
            }

            // 1. Calculate and display order summary
            const summaryList = document.getElementById('summary-list');
            summaryList.innerHTML = ''; // Clear previous summary

            // Add selected items to summary
            const selectedItems = document.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked');
            selectedItems.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.labels[0].textContent; // Get label text
                summaryList.appendChild(li);
            });

            const total = calculateTotal();
            document.getElementById('summary-total').textContent = `Total: RM ${total.toFixed(2)}`;

            // 2. Hide the initial order form
            document.getElementById('order-form').style.display = 'none';

            // 3. Show the summary section
            document.getElementById('order-summary').style.display = 'block';
        }

        // Function to handle payment slip upload using Imgur API
        async function uploadPaymentSlip(file) {
            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        Authorization: 'Client-ID 6d93506cc27e293', // Your Imgur Client ID
                    },
                    body: formData,
                });

                const data = await response.json();
                console.log('Imgur API Response:', data); // Log the API response for debugging

                if (data.success) {
                    // Ensure the link is a direct image link
                    const directImageLink = data.data.link.replace(/^http:\/\//i, 'https://');
                    return directImageLink; // Return the direct image URL
                } else {
                    throw new Error(data.data.error || 'Failed to upload image');
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                alert(`Failed to upload payment slip: ${error.message}`);
                return null;
            }
        }

        // Function to handle payment slip submission
        async function submitPaymentSlip() {
            const fileInput = document.getElementById('payment-slip');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please upload a payment slip.');
                return;
            }

            const imageUrl = await uploadPaymentSlip(file);
            if (imageUrl) {
                alert(`Payment slip uploaded successfully! URL: ${imageUrl}`);
                // Show the WhatsApp button and reminder
                document.getElementById('whatsapp-button').style.display = 'block';
                document.getElementById('reminder').style.display = 'block';
                // Store the image URL for WhatsApp
                document.getElementById('whatsapp-button').setAttribute('data-image-url', imageUrl);
            }
        }

        // Function to send order to WhatsApp
        function sendOrderToWhatsApp() {
            // Get sender details
            const senderName = document.getElementById('name').value;
            const senderPhone = document.getElementById('tel').value;
            const senderAddress = document.getElementById('address').value;

            // Get order details
            const orderSummary = document.getElementById('summary-list').innerText;
            const total = document.getElementById('summary-total').innerText;
            const imageUrl = document.getElementById('whatsapp-button').getAttribute('data-image-url');

            // Seller's WhatsApp number (replace with the actual number)
            const sellerWhatsAppNumber = '60189800195'; // Updated WhatsApp number

            // Format the WhatsApp message
            let message = `*Order Details:*\n\n` +
                           `*Sender Information:*\n` +
                           `Name: ${senderName}\n` +
                           `Phone: ${senderPhone}\n` +
                           `Address: ${senderAddress}\n\n` +
                           `*Order Summary:*\n${orderSummary}\n${total}\n\n` +
                           `*Payment Slip:* ${imageUrl}\n\n`;

            const encodedMessage = encodeURIComponent(message);

            // Create the WhatsApp URL with the seller's number
            const whatsappUrl = `https://wa.me/${sellerWhatsAppNumber}?text=${encodedMessage}`;

            // Open WhatsApp in a new tab
            window.open(whatsappUrl, '_blank');
        }

        // Event listener for DOMContentLoaded
        window.addEventListener('DOMContentLoaded', (event) => {
            // Add event listeners for total calculation
            const inputs = document.querySelectorAll('input[type="radio"], input[type="checkbox"]');
            inputs.forEach(input => {
                input.addEventListener('change', calculateTotal);
            });

            // Add event listener for payment slip upload
            document.getElementById('payment-slip').addEventListener('change', (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    document.getElementById('payment-slip-preview').src = e.target.result;
                    document.getElementById('payment-slip-preview').style.display = 'block';
                };

                reader.readAsDataURL(file);
            });

            // Add event listener for Ramadan day selection
            document.getElementById('ramadan-day').addEventListener('change', updateSelectedDate);

            // Populate Ramadan days dropdown
            const ramadanDaySelect = document.getElementById('ramadan-day');
            const ramadanDays = generateRamadanDays();
            ramadanDays.forEach((day, index) => {
                const option = document.createElement('option');
                option.value = day.day;
                option.textContent = `Day ${day.day} (${day.ceDate})`;
                ramadanDaySelect.appendChild(option);
            });
        });
    </script>
</head>

<body>
    <!-- Your existing HTML content -->
</body>

</html>